# 최적화 엔진 설계 문서

이 문서는 `backend/optimizer/engine.py` 중심의 경로 최적화 로직을 설명합니다.

## 목표

- 물류 차량의 운행 경로를 최적화하여:
  - 총 거리/시간 최소화.
  - CO2 배출 최소화.
  - 비즈니스 제약 조건(차량 용량, 근무시간 등)을 만족합니다.

## 입력 데이터 (개념)

- 차량 목록:
  - `id`, `capacity`, `co2_per_km`, 기타 속성.
- 작업(Job) 목록:
  - `id`, `sector_id`, `demand`, `lat`, `lng`, 서비스 시간 등.
- 제약 조건:
  - 최대 거리/시간.
  - 차량별 하중 제한.

## 출력 데이터 (개념)

- `routes`:
  - 각 차량별 방문 순서, 이동 거리, 소요 시간, CO2.
- `assignments`:
  - 어떤 작업이 어떤 차량에 할당되었는지.
- `kpis`:
  - 총 거리, 총 CO2, 평균 적재율 등.

## 사용 기술

- Google OR-Tools:
  - Vehicle Routing Problem(VRP) 또는 변형 모델.
  - Distance/Time/Capacity 등 다중 제약을 모델링.

## 기본 알고리즘 흐름

1. 입력 데이터 전처리 (좌표, 거리 매트릭스 등 생성).
2. OR-Tools 모델 생성.
3. 제약 조건 등록.
4. 목표 함수 설정 (예: 총 거리 + CO2 최소화).
5. Solver 실행.
6. 결과 해석 및 도메인 모델로 변환.

## 오류/예외 처리

- 해 불능(Infeasible)인 경우:
  - 원인을 로그로 남기고, 부분해/대체안 제공 여부를 결정합니다.
- 입력 검증:
  - 잘못된 좌표/수요/용량 등은 사전에 Validation 합니다.

