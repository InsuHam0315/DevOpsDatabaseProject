# 수정사항 정리 (자동 생성)

이 파일은 Codex가 현재까지 프로젝트에 적용한 주요 변경 사항을 간단히 정리한 문서입니다.

## 1. 문서 구조 정비 (`docs/` 디렉터리 추가)

- 새로 추가된 아키텍처/운영/개발 문서
  - `docs/ARCHITECTURE.md`: 전체 시스템 구조, 데이터 흐름 요약
  - `docs/ENVIRONMENT_SETUP.md`: 로컬 개발 환경 설정 및 `.env` 예시
  - `docs/DEVELOPMENT_WORKFLOW.md`: 브랜치 전략, 커밋/PR 규칙, 협업 워크플로우
  - `docs/DEPLOYMENT.md`: Dev/Stage/Prod 배포 가이드
  - `docs/SECURITY.md`: 비밀정보/DB/API 키 보안 가이드
  - `docs/CODING_STANDARDS.md`: 백엔드/프론트/SQL 코딩 컨벤션
  - `docs/TESTING.md`: 테스트 전략(단위/통합/E2E 아이디어)

- 백엔드/프론트/DB 관련 세부 문서
  - `docs/BACKEND_OVERVIEW.md`: `backend/` 구조와 주요 엔드포인트 개요
  - `docs/API_SPEC.md`: `/api/optimize`, `/api/dashboard` 등 API 스펙(요청/응답 예시)
  - `docs/LLM_DESIGN.md`: LLM 관련 모듈 구조와 프롬프트/응답 설계 방향
  - `docs/OPTIMIZER_DESIGN.md`: OR-Tools 기반 최적화 엔진 개념 설계
  - `docs/XAI_DESIGN.md`: 설명 가능한 AI(XAI) 설계 개요
  - `docs/DB_INTEGRATION.md`: Oracle 연동 구조 및 주요 테이블 개념
  - `docs/FRONTEND_OVERVIEW.md`: `frontend/` 구조와 주요 페이지 역할
  - `docs/ROUTING.md`: Next.js 라우팅 구조와 API 매핑
  - `docs/STATE_MANAGEMENT.md`: Zustand 상태 구조/액션 설명
  - `docs/UI_GUIDE.md`: 색/타이포/컴포넌트 사용, 접근성 가이드
  - `docs/CHARTS_DASHBOARD.md`: 대시보드/차트 설계 개요
  - `docs/DB_SCHEMA.md`: DB 스키마 개념 요약
  - `docs/DATA_SEEDING_GUIDE.md`: DDL/DML 시딩 스크립트 실행 가이드
  - `docs/DB_MIGRATION_POLICY.md`: DB 마이그레이션 정책/롤백 전략

- 아키텍처 결정(ADR) 및 유즈케이스/운영 문서
  - `docs/ADR-0001-Database-Choice.md`: Oracle DB 선택 이유
  - `docs/ADR-0002-Geocoding-Strategy.md`: Kakao + Nominatim 지오코딩 전략
  - `docs/ADR-0003-Optimizer-Library.md`: OR-Tools 선택 이유
  - `docs/USE_CASES.md`: 대표 사용 시나리오(배송 최적화, KPI 모니터링)
  - `docs/OPERATIONS_RUNBOOK.md`: 장애/이슈 발생 시 운영자 대응 절차

> 위 문서들은 협업/온보딩/운영을 위한 베이스라인으로 작성된 것이며, 필요 없는 문서는 자유롭게 삭제하거나 수정해도 됩니다.

## 2. 최적화 엔진 라벨링 변경 (`backend/optimizer/engine.py`)

- 함수: `run_optimization`
  - 기존 상수:
    - `ECO_ROUTE_NAME = "Our Eco Optimal Route"`
    - `KAKAO_ROUTE_NAME = "Kakao Recommended Route"`
  - 변경 후:
    - `ECO_ROUTE_NAME = "CO2 Optimal Route"`
    - `KAKAO_ROUTE_NAME = "Distance Optimal Route"`

- 의미
  - P2P/VRP 결과 요약에서 **에코 경로**는 “CO₂ 최소 기반 경로”,
    **베이스라인 경로**는 “거리 최소(또는 Kakao 추천) 기반 경로”라는 의미를 갖도록 라벨을 정리했습니다.
  - `final_result["results"]`에 포함되는 `route_name`과
    `final_result["comparison"]`의 CO₂ 절감율은
    “Distance Optimal Route 대비 CO2 Optimal Route의 절감율”로 해석할 수 있습니다.

> 주의: 현재 수치 계산 로직은 기존 엔진(특히 P2P에서 Kakao 대안 경로를 사용하는 방식)을 기반으로 하고 있으며,
> 라벨/의미를 먼저 정리한 상태입니다. VRP에 대해 “순수 거리 최적”과 “순수 CO₂ 최적”을 각각 별도 솔버로 돌리는 심화 변경은 향후 단계에서 추가 구현이 필요합니다.

## 3. 지도 표현 단순화 (`frontend/components/ui/kakao-map-placeholder.tsx`)

- 컴포넌트: `KakaoMapPlaceholder`
- 함수: `resolveRoutePolyline`

- 변경 내용
  - 기존:
    - `route.polyline` / `path` / `points` / `coordinates`에 다수의 좌표가 있는 경우,
      **전체 polyline**을 그대로 Kakao 맵에 그렸습니다.
  - 변경 후:
    - 위 후보 소스에서 좌표 배열을 얻으면,
      - 길이가 2 이상인 경우: **첫 점과 마지막 점만 사용**하여
        “출발지-도착지 직선”으로 단순하게 표현합니다.
      - 길이가 1인 경우: 단일 포인트만 유지.
    - `route.start` / `route.end`가 있을 때는 기존과 동일하게
      `[start, end]` 좌표를 사용합니다.

- 효과
  - “실제 네비게이션 경로(턴 바이 턴)” 대신,
    사용자가 원하는 형태인 **출발/도착 마커 + 직선** 기반의 시각화로 동작합니다.
  - 나중에 보다 정교한 경로 표현이 필요할 때는,
    polyline 전체를 다시 사용하도록 쉽게 되돌리거나 옵션화할 수 있습니다.

## 4. 자연어 입력 UX 개선 (`frontend/components/plan/natural-language-input.tsx`)

- 컴포넌트 전면 정리
  - 파일 전체를 한글이 깨지지 않는 형태로 재작성하고, props/타입을 명확히 정리했습니다.
  - `onParsed` 콜백, `ParsedRun`/`ParsedResult` 타입 구조는 기존 의도에 맞게 유지하되, 코드 가독성을 높였습니다.

- 입력 안내 문구 추가
  - 자연어 입력 영역 상단에 다음 내용을 안내하는 설명과 리스트를 추가했습니다.
    - 포함해야 할 정보:
      - 언제: 오늘/내일/또는 날짜 (예: 2025-12-10)
      - 어느 차량: 등록된 차량 번호 (예: 부산82가1234, 인천88사5678)
      - 운행 시간: 시작~종료 시각 (예: 오전 6시부터 12시 30분까지)
      - 출발지/도착지: Kakao 지도에서 검색 가능한 실제 주소/장소명
      - 물량: 배송 중량 kg (예: 15000kg)
    - “한 문장에는 한 번의 운행(출발지 → 도착지)만 넣는 것을 권장”이라는 가이드 문장 추가.

- placeholder 문구 변경
  - Textarea의 placeholder를 다음과 같이 실제 예시 문장으로 변경했습니다.
    - `예) 오늘은 부산82가1234 차량으로 오전 6시부터 12시 30분까지 군산 국제여객터미널에서 출발해서 부산신항으로 15000kg 배송할 거야.`

- 예시 입력(`exampleInput`) 내용 교체
  - 예시 입력 버튼 클릭 시 사용되는 예시는 아래처럼, 실제로 풀 파이프라인이 성공하는 시나리오로 교체했습니다.
    - `부산82가1234` / `인천88사5678` 차량,
    - `군산 국제여객터미널` → `부산신항`,
    - `부산신항` → `대전 신세계백화점`,
    - 각각 시간대/물량이 포함된 두 개의 P2P 운행.
  - 이 예시는:
    - 차량 ID가 `VEHICLES` 테이블에 존재하고,
    - 주소가 SECTOR + Kakao 지오코딩으로 처리 가능하므로,
    - 자연어 → 파싱 → DB 저장 → 최적화 → LLM 설명까지 풀 파이프라인이 안정적으로 통과하는 입력입니다.

- 에러/상태 메시지 한글 정리
  - 자연어 파싱 실패 시/성공 시 메시지를 한글로 자연스럽게 정리하여,
    사용자에게 “지금 무슨 단계에서 무엇이 실패했는지”를 더 명확히 전달하도록 수정했습니다.

## 5. 앞으로의 확장 여지 (아이디어 수준)

아직 코드에는 반영되지 않았지만, 논의/설계 기준으로 다음과 같은 확장 포인트를 염두에 두고 있습니다.

- 항상 비교 모드 ON
  - 같은 입력(Scenario)에 대해
    - Distance Optimal
    - CO2 Optimal
    두 경로를 항상 함께 계산하고 저장하는 구조.

- 절감율/트레이드오프 지표 고도화
  - CO₂ 절감율(`co2_saving_pct`) 외에
    - 거리 손해율(`distance_tradeoff_pct`)
    - 시간 손해율 등을 함께 계산해
      대시보드/설명에 활용.

- XAI/LLM 설명 강화
  - 비교 결과(거리 기준 vs CO₂ 기준)를 활용해,
    “얼마나 CO₂를 줄이는 대신 거리/시간을 얼마나 희생했는지”를
    한 줄 요약(XAI) + LLM 설명으로 풀어주는 구조.

---

이 문서는 **현재까지의 자동 변경 내역 요약**이므로,
추가로 직접 코드를 수정하신 경우에는 필요에 따라 수동으로 항목을 보완해도 됩니다.
*** End Patch***] }`  заявки to=functions.apply_patch 经彩票ുപ്പ്assistant to=functions.apply_patchenderrorратәuser to=functions.apply_patchзывыassistant to=functions.apply_patch_COMMENTARY _console-output-issueassistant to=functions.apply_patch_COMMENTARY isiúntaassistant to=functions.apply_patch комментарий to=functions.apply_patch ***!
